!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.plugins,n=window.wp.element,o=window.wp.i18n,r=window.wp.compose,i=window.wp.data,a=window.wp.editor,l=window.wp.components,c=window.wp.apiFetch,s=e.n(c);function u({shortLink:e,workspaceSlug:t}){let r,i;try{const t=new URL(e);r=t.hostname,i=t.pathname.split("/")[1]}catch(e){return console.error("Invalid URL:",e),null}return(0,n.createElement)("div",{className:"dubco-analytics-link"},(0,n.createElement)("p",null,(0,n.createElement)("a",{href:`https://app.dub.co/${t}/analytics?domain=${r}&key=${i}&tab=clicks`,target:"_blank",rel:"noopener noreferrer"},(0,o.__)("Analytics for link","dubco-plugin"))))}const d=(0,i.withSelect)((e=>({metaFields:e("core/editor").getEditedPostAttribute("meta"),postStatus:e("core/editor").getEditedPostAttribute("status"),postId:e("core/editor").getCurrentPostId()}))),p=(0,i.withDispatch)((e=>({setMetaFields(t){e("core/editor").editPost({meta:t})}})));var _=(0,r.compose)([d,p])((({postStatus:e,metaFields:t,setMetaFields:r,postId:i})=>{const[c,d]=(0,n.useState)(!1),[p,_]=(0,n.useState)(""),[m,b]=(0,n.useState)(""),[h,w]=(0,n.useState)(!1),{_dubco_short_url:g,_dubco_short_url_id:k,_dubco_short_url_error:E,_dubco_workspace_slug:y}=t;return(0,n.useEffect)((()=>{if(g){const e=new URL(g);_(e.pathname.substring(1))}}),[g]),"publish"!==e?(0,n.createElement)(a.PluginDocumentSettingPanel,{title:(0,o.__)("Dubco","dubco-plugin"),initialOpen:!1},(0,n.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,o.__)("You can only create short links for published posts. A short link will be created automatically, if it doesn't exists when this post is published","dubco-plugin"))):(0,n.createElement)(a.PluginDocumentSettingPanel,{title:(0,o.__)("Dubco","dubco-plugin"),initialOpen:!1},(0,n.createElement)(l.PanelRow,null,(0,n.createElement)("div",null,g&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{className:"dubco-short-link"},c?(0,n.createElement)(l.TextControl,{value:p,label:(0,o.__)("Edit the pathname","dubco-plugin"),onChange:e=>_(e)}):(0,n.createElement)(l.TextControl,{value:g,label:(0,o.__)("Url","dubco-plugin"),onChange:e=>r({_dubco_short_url:e}),readOnly:!0}),c?(0,n.createElement)(l.Button,{variant:"primary",onClick:async()=>{try{b(""),w(!0);const e=await(async(e,t,n)=>s()({path:`/dubco/v1/links/${t}`,method:"PATCH",data:{post_id:e,key:n}}))(i,k,p);e&&r({_dubco_short_url:e.shortLink})}catch(e){b(e)}finally{w(!1)}d(!c)}},h?(0,o.__)("Updating","dubco-plugin"):(0,o.__)("Update","dubco-plugin")):(0,n.createElement)(l.Button,{variant:"primary",onClick:()=>d(!c)},(0,o.__)("Edit","dubco-plugin"))),m&&(0,n.createElement)(l.Notice,{status:"error"},m),(0,n.createElement)(u,{shortLink:g,workspaceSlug:y})),!g&&(0,n.createElement)("div",{className:"dubco-creat-link"},(0,n.createElement)(l.Button,{variant:"primary",disabled:h,description:(0,o.__)("Create a short link for this post","dubco-plugin"),onClick:async()=>{try{b(""),w(!0);const e=await(async e=>s()({path:"/dubco/v1/links",method:"POST",data:{post_id:e}}))(i);e&&r({_dubco_short_url:e.shortLink})}catch(e){b(e)}finally{w(!1)}}},h?(0,o.__)("Creating Short Link...","dubco-plugin"):(0,o.__)("Create Short Link","dubco-plugin")),E&&(0,n.createElement)(l.Notice,{status:"error",onRemove:()=>{r({_dubco_short_url_error:""})}},E),m&&(0,n.createElement)(l.Notice,{status:"error"},m)))))}));(0,t.registerPlugin)("dubco-side-panel",{render:_})}();