!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.plugins,n=window.wp.element,r=window.wp.i18n,i=window.wp.compose,a=window.wp.data,o=window.wp.editor,l=window.wp.components,c=window.wp.apiFetch,s=e.n(c);var u,d=({shortLink:e})=>{let t,i;try{const n=new URL(e);t=n.hostname,i=n.pathname.split("/")[1]}catch(e){return console.error("Invalid URL:",e),null}return(0,n.createElement)("div",{className:"dubco-analytics-link"},(0,n.createElement)("p",null,(0,n.createElement)("a",{href:`https://app.dub.co/analytics?domain=${t}&key=${i}&tab=clicks`,target:"_blank",rel:"noopener noreferrer"},(0,r.__)("Analytics for link","dubinc"))))},p=window.React;function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_.apply(null,arguments)}var h=function(e){return p.createElement("svg",_({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",style:{paddingTop:4},viewBox:"0 0 64 64"},e),u||(u=p.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 64c17.673 0 32-14.327 32-32 0-11.844-6.435-22.186-16-27.719V48h-8v-2.14A15.9 15.9 0 0 1 32 48c-8.837 0-16-7.163-16-16s7.163-16 16-16c2.914 0 5.647.78 8 2.14V1.008A32 32 0 0 0 32 0C14.327 0 0 14.327 0 32s14.327 32 32 32",clipRule:"evenodd"})))};const m=(0,a.withSelect)((e=>({metaFields:e("core/editor").getEditedPostAttribute("meta"),postStatus:e("core/editor").getEditedPostAttribute("status"),postId:e("core/editor").getCurrentPostId()}))),b=(0,a.withDispatch)((e=>({setMetaFields(t){e("core/editor").editPost({meta:t})}})));var w=(0,i.compose)([m,b])((({postStatus:e,metaFields:t,setMetaFields:i,postId:a})=>{const[c,u]=(0,n.useState)(!1),[p,_]=(0,n.useState)(""),[m,b]=(0,n.useState)(""),[w,f]=(0,n.useState)(!1),{_dubco_short_url:v,_dubco_short_url_id:E,_dubco_short_url_error:g}=t;return(0,n.useEffect)((()=>{if(v){const e=new URL(v);_(e.pathname.substring(1))}}),[v]),"publish"!==e?(0,n.createElement)(o.PluginDocumentSettingPanel,{title:(0,r.__)("Dub","dubinc"),initialOpen:!1,icon:(0,n.createElement)(h,null)},(0,n.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,r.__)("You can only create short links for published posts. A short link will be created automatically, if it doesn't exists when this post is published","dubinc"))):(0,n.createElement)(o.PluginDocumentSettingPanel,{title:(0,r.__)("Dubco","dubinc"),initialOpen:!1},(0,n.createElement)(l.PanelRow,null,(0,n.createElement)("div",null,v&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{className:"dubco-short-link"},c?(0,n.createElement)(l.TextControl,{value:p,label:(0,r.__)("Edit the pathname","dubinc"),onChange:e=>_(e)}):(0,n.createElement)(l.TextControl,{value:v,label:(0,r.__)("Url","dubinc"),onChange:e=>i({_dubco_short_url:e}),readOnly:!0}),c?(0,n.createElement)(l.Button,{variant:"primary",onClick:async()=>{try{b(""),f(!0);const e=await(async(e,t,n)=>s()({path:`/dubco/v1/links/${t}`,method:"PATCH",data:{post_id:e,key:n}}))(a,E,p);e&&i({_dubco_short_url:e.shortLink})}catch(e){b(e)}finally{f(!1)}u(!c)}},w?(0,r.__)("Updating","dubinc"):(0,r.__)("Update","dubinc")):(0,n.createElement)(l.Button,{variant:"primary",onClick:()=>u(!c)},(0,r.__)("Edit","dubinc"))),m&&(0,n.createElement)(l.Notice,{status:"error"},m),(0,n.createElement)(d,{shortLink:v})),!v&&(0,n.createElement)("div",{className:"dubco-creat-link"},(0,n.createElement)(l.Button,{variant:"primary",disabled:w,description:(0,r.__)("Create a short link for this post","dubinc"),onClick:async()=>{try{b(""),f(!0);const e=await(async e=>s()({path:"/dubco/v1/links",method:"POST",data:{post_id:e}}))(a);e&&i({_dubco_short_url:e.shortLink})}catch(e){b(e)}finally{f(!1)}}},w?(0,r.__)("Creating Short Link...","dubinc"):(0,r.__)("Create Short Link","dubinc")),g&&(0,n.createElement)(l.Notice,{status:"error",onRemove:()=>{i({_dubco_short_url_error:""})}},g),m&&(0,n.createElement)(l.Notice,{status:"error"},m)))))}));(0,t.registerPlugin)("dubco-side-panel",{render:w})}();