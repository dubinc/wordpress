!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.plugins,n=window.wp.element,r=window.wp.i18n,a=window.wp.compose,i=window.wp.data,l=window.wp.editor,c=window.wp.components,o=window.wp.apiFetch,s=e.n(o);var u,d=({shortLink:e})=>{let t,a;try{const n=new URL(e);t=n.hostname,a=n.pathname.split("/")[1]}catch(e){return console.error("Invalid URL:",e),null}return(0,n.createElement)("div",{className:"dubco-analytics-link"},(0,n.createElement)("p",null,(0,n.createElement)("a",{href:`https://app.dub.co/analytics?domain=${t}&key=${a}&tab=clicks`,target:"_blank",rel:"noopener noreferrer"},(0,r.__)("Analytics for link","dubinc"))))},m=window.React;function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h.apply(null,arguments)}var _,p,b=function(e){return m.createElement("svg",h({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",style:{paddingTop:4},viewBox:"0 0 64 64"},e),u||(u=m.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 64c17.673 0 32-14.327 32-32 0-11.844-6.435-22.186-16-27.719V48h-8v-2.14A15.9 15.9 0 0 1 32 48c-8.837 0-16-7.163-16-16s7.163-16 16-16c2.914 0 5.647.78 8 2.14V1.008A32 32 0 0 0 32 0C14.327 0 0 14.327 0 32s14.327 32 32 32",clipRule:"evenodd"})))};function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(null,arguments)}var w,f,g=function(e){return m.createElement("svg",v({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),_||(_=m.createElement("g",{stroke:"#404040",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#click_svg__a)"},m.createElement("path",{d:"m7.193 6.914 6.501 2.23c.197.068.201.346.006.418l-2.914 1.097a.22.22 0 0 0-.13.13L9.56 13.702a.222.222 0 0 1-.418-.006L6.911 7.195a.223.223 0 0 1 .283-.282zM10.691 10.693l3.744 3.744M6.887 1.555v1.777M10.66 3.117 9.402 4.375M3.117 10.66l1.258-1.258M1.555 6.889h1.777M3.117 3.117l1.258 1.258"}))),p||(p=m.createElement("defs",null,m.createElement("clipPath",{id:"click_svg__a"},m.createElement("path",{fill:"#fff",d:"M0 0h16v16H0z"})))))};function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},k.apply(null,arguments)}var E,y=function(e){return m.createElement("svg",k({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),w||(w=m.createElement("g",{stroke:"#2B7FFF",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#click-activity_svg__a)"},m.createElement("path",{d:"m7.193 6.914 6.501 2.23c.197.068.201.346.006.418l-2.914 1.097a.22.22 0 0 0-.13.13L9.56 13.702a.222.222 0 0 1-.418-.006L6.911 7.195a.223.223 0 0 1 .283-.282zM10.691 10.693l3.744 3.744M6.887 1.555v1.777M10.66 3.117 9.402 4.375M3.117 10.66l1.258-1.258M1.555 6.889h1.777M3.117 3.117l1.258 1.258"}))),f||(f=m.createElement("defs",null,m.createElement("clipPath",{id:"click-activity_svg__a"},m.createElement("path",{fill:"#fff",d:"M0 0h16v16H0z"})))))};function L(){return L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},L.apply(null,arguments)}var M,O=function(e){return m.createElement("svg",L({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),E||(E=m.createElement("path",{stroke:"#404040",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 6.444a2.444 2.444 0 1 0 0-4.89 2.444 2.444 0 0 0 0 4.89M11.834 10.222A5.5 5.5 0 0 0 8 8.666a5.55 5.55 0 0 0-5.074 3.307c-.325.733.077 1.577.841 1.817 1.09.344 2.53.653 4.233.653M10 13.11l1.43 1.333 3.02-4"})))};function N(){return N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},N.apply(null,arguments)}var P,j,S=function(e){return m.createElement("svg",N({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),M||(M=m.createElement("path",{stroke:"#AD46FF",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 6.444a2.444 2.444 0 1 0 0-4.89 2.444 2.444 0 0 0 0 4.89M11.834 10.222A5.5 5.5 0 0 0 8 8.666a5.55 5.55 0 0 0-5.074 3.307c-.325.733.077 1.577.841 1.817 1.09.344 2.53.653 4.233.653M10 13.11l1.43 1.333 3.02-4"})))};function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C.apply(null,arguments)}var F,A,x=function(e){return m.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),P||(P=m.createElement("path",{stroke:"#404040",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13.113 3.332v11.112l-2.445-1.334-2.666 1.334-2.667-1.334-2.444 1.334V3.332c0-.982.795-1.777 1.777-1.777h6.667c.982 0 1.778.795 1.778 1.777"})),j||(j=m.createElement("path",{stroke:"#404040",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.535 5.827c-.332-.787-.997-.966-1.5-.966-.468 0-1.695.25-1.582 1.428.08.827.86 1.135 1.542 1.257.681.122 1.67.381 1.695 1.378.02.844-.738 1.42-1.654 1.42-.876 0-1.485-.34-1.72-1.111M8 4.22v.64M8 10.344v.544"})))};function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},R.apply(null,arguments)}var B=function(e){return m.createElement("svg",R({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),F||(F=m.createElement("path",{stroke:"#00BBA7",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13.113 3.332v11.112l-2.445-1.334-2.666 1.334-2.667-1.334-2.444 1.334V3.332c0-.982.795-1.777 1.777-1.777h6.667c.982 0 1.778.795 1.778 1.777"})),A||(A=m.createElement("path",{stroke:"#00BBA7",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.535 5.827c-.332-.787-.997-.966-1.5-.966-.468 0-1.695.25-1.582 1.428.08.827.86 1.135 1.542 1.257.681.122 1.67.381 1.695 1.378.02.844-.738 1.42-1.654 1.42-.876 0-1.485-.34-1.72-1.111M8 4.22v.64M8 10.344v.544"})))};const W=async e=>{const t=new URLSearchParams({post_id:String(e)}).toString();return s()({path:`/dubco/v1/links/info?${t}`,method:"GET"})},D=e=>Number.isFinite(e)?(new Intl.NumberFormat).format(e):"0",I=({linkInfo:e})=>{if(!e)return null;const t=Number(e.clicks)||0,a=Number(e.leads)||0,i=Number(e.sales)||0;return(0,n.createElement)("div",{className:"dubco-link-metrics"},(0,n.createElement)("div",{className:"dubco-link-metric",title:(0,r.__)("Clicks","dubinc"),"aria-label":(0,r.__)("Clicks","dubinc")},t>0?(0,n.createElement)(y,{className:"dubco-link-metric-icon"}):(0,n.createElement)(g,{className:"dubco-link-metric-icon"}),(0,n.createElement)("span",{className:"dubco-link-metric-value"},D(t))),(0,n.createElement)("div",{className:"dubco-link-metric",title:(0,r.__)("Leads","dubinc"),"aria-label":(0,r.__)("Leads","dubinc")},a>0?(0,n.createElement)(S,{className:"dubco-link-metric-icon"}):(0,n.createElement)(O,{className:"dubco-link-metric-icon"}),(0,n.createElement)("span",{className:"dubco-link-metric-value"},D(a))),(0,n.createElement)("div",{className:"dubco-link-metric",title:(0,r.__)("Sales","dubinc"),"aria-label":(0,r.__)("Sales","dubinc")},i>0?(0,n.createElement)(B,{className:"dubco-link-metric-icon"}):(0,n.createElement)(x,{className:"dubco-link-metric-icon"}),(0,n.createElement)("span",{className:"dubco-link-metric-value"},D(i))))},U=(0,i.withSelect)(e=>({metaFields:e("core/editor").getEditedPostAttribute("meta"),postStatus:e("core/editor").getEditedPostAttribute("status"),postId:e("core/editor").getCurrentPostId()})),T=(0,i.withDispatch)(e=>({setMetaFields(t){e("core/editor").editPost({meta:t})}}));var z=(0,a.compose)([U,T])(({postStatus:e,metaFields:t,setMetaFields:a,postId:i})=>{const[o,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(""),[_,p]=(0,n.useState)(""),[v,w]=(0,n.useState)(!1),[f,g]=(0,n.useState)(!1),[k,E]=(0,n.useState)(null),{_dubco_short_url:y,_dubco_short_url_id:L,_dubco_short_url_error:M}=t;return(0,n.useEffect)(()=>{i&&L&&async function(){try{const e=await W(i);E(e)}catch(e){p(e?.message||e)}}()},[i,L]),(0,n.useEffect)(()=>{if(y){const e=new URL(y);h(e.pathname.substring(1))}},[y]),"publish"!==e?(0,n.createElement)(l.PluginDocumentSettingPanel,{title:(0,r.__)("Dub","dubinc"),initialOpen:!1,icon:(0,n.createElement)(b,null)},(0,n.createElement)(c.Notice,{status:"warning",isDismissible:!1},(0,r.__)("You can only create short links for published posts. A short link will be created automatically, if it doesn't exists when this post is published","dubinc"))):(0,n.createElement)(l.PluginDocumentSettingPanel,{title:(0,r.__)("Dub","dubinc"),initialOpen:!1},(0,n.createElement)(c.PanelRow,null,(0,n.createElement)("div",null,y&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{className:"dubco-short-link"},o?(0,n.createElement)(c.TextControl,{value:m,label:(0,r.__)("Edit the pathname","dubinc"),onChange:e=>h(e)}):(0,n.createElement)(c.TextControl,{value:y,label:(0,r.__)("Url","dubinc"),onChange:e=>a({_dubco_short_url:e}),readOnly:!0}),o?(0,n.createElement)(c.Button,{variant:"primary",onClick:async()=>{try{p(""),w(!0);const e=await(async(e,t,n)=>s()({path:`/dubco/v1/links/${t}`,method:"PATCH",data:{post_id:e,key:n}}))(i,L,m);e&&(a({_dubco_short_url:e.shortLink,_dubco_short_url_id:e.id,_dubco_short_url_domain:e.domain}),E(e))}catch(e){p(e?.message||e)}finally{w(!1)}u(!o)}},v?(0,r.__)("Updating","dubinc"):(0,r.__)("Update","dubinc")):(0,n.createElement)(c.Button,{variant:"primary",onClick:()=>u(!o)},(0,r.__)("Edit","dubinc"))),_&&(0,n.createElement)(c.Notice,{status:"error"},_),(0,n.createElement)("div",{className:"dubco-link-metrics-container"},(0,n.createElement)(d,{shortLink:y}),(0,n.createElement)(I,{linkInfo:k}))),!y&&(0,n.createElement)("div",{className:"dubco-creat-link"},(0,n.createElement)(c.Button,{variant:"primary",disabled:v,description:(0,r.__)("Create a short link for this post","dubinc"),onClick:async()=>{try{p(""),w(!0);const e=await(async e=>s()({path:"/dubco/v1/links",method:"POST",data:{post_id:e}}))(i);e&&(a({_dubco_short_url:e.shortLink,_dubco_short_url_id:e.id,_dubco_short_url_domain:e.domain}),E(e))}catch(e){p(e?.message||e)}finally{w(!1)}}},v?(0,r.__)("Creating Short Link...","dubinc"):(0,r.__)("Create Short Link","dubinc")),M&&(0,n.createElement)(c.Notice,{status:"error",onRemove:()=>{a({_dubco_short_url_error:""})}},M,(0,n.createElement)(c.Button,{variant:"secondary",disabled:v||f,onClick:async()=>{try{p(""),g(!0);const e=await W(i);e&&(a({_dubco_short_url:e.shortLink,_dubco_short_url_id:e.id,_dubco_short_url_domain:e.domain,_dubco_short_url_error:""}),E(e))}catch(e){p(e?.message||e)}finally{g(!1)}}},f?(0,r.__)("Retrying","dubinc"):(0,r.__)("Retry","dubinc"))),_&&(0,n.createElement)(c.Notice,{status:"error"},_)))))});(0,t.registerPlugin)("dubco-side-panel",{render:z})}();